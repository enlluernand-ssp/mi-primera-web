<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Enlluernand ‚Äî Configurador & Cat√°logo</title>

  <!-- EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

  <!-- Firebase SDK (modular) -->
  <script type="module">
    // Importar Firebase modular
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
    import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js';
    import { getFirestore, collection, getDoc, setDoc, doc } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';

    // Configuraci√≥n de Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCZbhHY9mEr3bBMVZLGxZE4NkGMLSPTcL4",
      authDomain: "enlluernand-77eb5.firebaseapp.com",
      projectId: "enlluernand-77eb5",
      storageBucket: "enlluernand-77eb5.firebasestorage.app",
      messagingSenderId: "904366283683",
      appId: "1:904366283683:web:816bf521d4b858a4a25816"
    };

    // Inicializar Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Hacer disponibles en window para el resto del script
    window.firebase = {
      auth,
      firestore: db,
      onAuthStateChanged,
      GoogleAuthProvider,
      signInWithPopup,
      signInWithEmailAndPassword,
      createUserWithEmailAndPassword,
      signOut,
      collection,
      doc,
      getDoc,
      setDoc
    };
  </script>

  <!-- Librer√≠as para PDF (opcional) -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #e6f3ff; }
    header {
      background: #0077cc;
      color: white;
      padding: 15px 20px;
      position: relative;
      text-align: left;
    }
    header h1 { margin: 0; font-size: 28px; text-align: center; }
    header p { margin: 5px 0 0; font-size: 16px; text-align: center; }

    .header-buttons {
      display: flex;
      gap: 15px;
      position: absolute;
      top: 15px;
      right: 20px;
    }

    .auth-btn, .cart-btn {
      padding: 8px 16px;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .auth-btn { background: white; color: #0077cc; border: none; }
    .auth-btn:hover { background: #eef; }
    .cart-btn { background: #0077cc; color: white; border: none; }
    .cart-btn:hover { background: #005fa3; }

    .main-container { display: flex; gap: 20px; max-width: 1400px; margin: 20px auto; padding: 0 20px; }
    section { background: #fff; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 20px; }
    #configurador { flex: 2; }
    #catalogo { flex: 1; }

    h2 { border-bottom: 2px solid #0077cc; padding-bottom: 5px; }
    label { display: block; margin: 8px 0 4px; font-weight: bold; }
    select, input[type="number"], input[type="text"] { width: 100%; padding: 6px; margin-bottom: 10px; border-radius: 6px; border: 1px solid #ccc; }
    button { background: #0077cc; color: #fff; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; margin: 5px 5px 0 0; }
    button:hover { background: #005fa3; }
    .summary { background: #eef7ff; padding: 10px; border-radius: 6px; margin-top: 10px; }

    .color-options { display: flex; gap: 10px; margin: 8px 0 12px; }
    .color-ball { width: 24px; height: 24px; border-radius: 50%; border: 1px solid #333; cursor: pointer; }
    .config-container { display: flex; gap: 20px; }
    .preview { flex: 1; background: #f9f9f9; border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-direction: column; font-size: 18px; min-height: 300px; }

    .item-list {
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 10px;
      margin-bottom: 10px;
      max-height: 200px;
      overflow-y: auto;
    }

    .item-row {
      display: flex;
      justify-content: space-between;
      padding: 5px 0;
      border-bottom: 1px solid #eee;
    }

    .item-row button {
      background: #ff6666; color: white; border: none; padding: 2px 6px; border-radius: 4px; cursor: pointer;
    }

    .sidebar { position: fixed; top: 0; right: -400px; width: 350px; height: 100%; background: #fff; box-shadow: -2px 0 8px rgba(0,0,0,0.2); transition: right 0.3s ease; padding: 20px; display: flex; flex-direction: column; z-index: 1000; }
    .sidebar.open { right: 0; }
    .sidebar h2 { margin-top: 0; }
    .cesta-item { border-bottom: 1px solid #ddd; padding: 10px 0; }
    .close-btn { background: #ccc; color: black; align-self: flex-end; margin-bottom: 10px; }
  </style>
</head>
<body>

  <header>
    <h1>Enlluernand</h1>
    <p>Crea tu accesorio o descubre nuestras creaciones</p>
    <div class="header-buttons">
      <button class="auth-btn" id="authButton">Iniciar sesi√≥n</button>
      <button class="cart-btn" id="openCart">üõí Cesta (0)</button>
    </div>
  </header>

  <!-- Modal de Bienvenida -->
  <div id="welcomeModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:9999;">
    <div style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); background:white; padding:30px; border-radius:12px; max-width:400px; text-align:center;">
      <h2 id="welcomeTitle">üéâ ¬°Hola!</h2>
      <p id="welcomeMessage">Tu c√≥digo de descuento es:</p>
      <div id="discountCode" style="font-size:1.5em; font-weight:bold; color:#0077cc; margin:10px 0;"></div>
      <button onclick="copyCode()" style="background:#0077cc; color:white; padding:10px 20px; border:none; border-radius:6px; cursor:pointer;">Copiar c√≥digo</button>
      <button onclick="useCode()" style="margin-top:10px; background:#0077cc; color:white; padding:10px 20px; border:none; border-radius:6px; cursor:pointer;">Usar c√≥digo</button>
      <button onclick="closeModal()" style="margin-top:10px; background:#ccc; color:black; padding:10px 20px; border:none; border-radius:6px; cursor:pointer;">Cerrar</button>
    </div>
  </div>

  <div class="main-container">
    <!-- Configurador -->
    <section id="configurador">
      <h2>Configurador de accesorios</h2>
      <div class="config-container">
        <div class="preview" id="preview"><strong>collar</strong><br>Material: oro</div>
        <div class="controls">
          <label>Producto</label>
          <select id="product">
            <option value="collar">Collar</option>
            <option value="pulsera">Pulsera</option>
            <option value="pendientes">Pendientes</option>
          </select>

          <label>Material</label>
          <select id="material">
            <option value="oro">Cadena de oro</option>
            <option value="plata">Cadena de plata</option>
            <option value="cordon">Cord√≥n de colores</option>
          </select>

          <label>Colores disponibles</label>
          <div class="color-options" id="colorOptions">
            <div class="color-ball" style="background:red" data-color="rojo"></div>
            <div class="color-ball" style="background:blue" data-color="azul"></div>
            <div class="color-ball" style="background:green" data-color="verde"></div>
            <div class="color-ball" style="background:yellow" data-color="amarillo"></div>
            <div class="color-ball" style="background:pink" data-color="rosa"></div>
            <div class="color-ball" style="background:purple" data-color="morado"></div>
          </div>

          <label>Colgante</label>
          <select id="colgante">
            <option value="">Ninguno</option>
            <option value="corazon">Coraz√≥n</option>
            <option value="estrella">Estrella</option>
            <option value="nube">Nube</option>
          </select>

          <!-- Conectores m√∫ltiples -->
          <div>
            <label>Conectores adicionales</label>
            <div class="item-list" id="conectores-list">
              <div class="item-row" id="conector-template" style="display:none;">
                <span class="name"></span>
                <input type="number" value="1" min="1" class="cantidad" style="width:50px;">
                <button class="remove">‚úñ</button>
              </div>
            </div>
            <select id="add-conector-select">
              <option value="">Seleccionar conector...</option>
            </select>
            <button type="button" id="add-conector-btn">+ A√±adir conector</button>
          </div>

          <!-- Extras m√∫ltiples -->
          <div>
            <label>Extras</label>
            <div class="item-list" id="extras-list">
              <div class="item-row" id="extra-template" style="display:none;">
                <span class="name"></span>
                <input type="number" value="1" min="1" class="cantidad" style="width:50px;">
                <button class="remove">‚úñ</button>
              </div>
            </div>
            <select id="add-extra-select">
              <option value="">Seleccionar extra...</option>
              <option value="gift">Estuche para regalo (+5‚Ç¨)</option>
              <option value="wrap">Envoltorio para regalo (+3‚Ç¨)</option>
              <option value="urgent">Fabricaci√≥n urgente (+10‚Ç¨)</option>
            </select>
            <button type="button" id="add-extra-btn">+ A√±adir extra</button>
          </div>

          <label>C√≥digo de descuento</label>
          <input type="text" id="discount" placeholder="Introduce tu c√≥digo">

          <label>Cantidad</label>
          <input type="number" id="quantity" value="1" min="1">

          <div class="summary" id="summary">Precio: ‚Ç¨0</div>

          <!-- Bot√≥n para a√±adir el art√≠culo completo a la cesta -->
          <button id="addProductToCart">+ A√±adir art√≠culo</button>
          <button id="payNow">Pagar ahora</button>
        </div>
      </div>
    </section>

    <!-- Cat√°logo -->
    <section id="catalogo">
      <h2>Cat√°logo</h2>
      <h3>Collares</h3>
      <img src="https://via.placeholder.com/200?text=Collar+1">
      <h3>Pendientes</h3>
      <img src="https://via.placeholder.com/200?text=Pendiente+1">
      <h3>Pulseras</h3>
      <img src="https://via.placeholder.com/200?text=Pulsera+1">
    </section>
  </div>

  <!-- Sidebar de la Cesta -->
  <div class="sidebar" id="cartSidebar">
    <button class="close-btn" id="closeCart">Cerrar ‚úñ</button>
    <h2>Tu Cesta</h2>
    <div id="cartItems"></div>
    <div class="summary" id="cartSummary">Total: ‚Ç¨0</div>
    <button id="pay">Pagar</button>
  </div>

  <script type="module">
    // Importar firebase desde el m√≥dulo inicializado
    const { auth, firestore: db } = window.firebase;

    // Datos de tu Excel (solo conectores)
    const materiales = [
      {"Codigo": 13,"Descripcion": "Conector Collar ORO","Unidades": 20,"Precio": "2,9200","Costo": "0,1460","Unidades Restantes": 20},
      {"Codigo": 14,"Descripcion": "Conector Collar PLATA","Unidades": 20,"Precio": "2,6000","Costo": "0,1300","Unidades Restantes": 20},
      {"Codigo": 15,"Descripcion": "Conector Resina ORO","Unidades": 40,"Precio": "1,3900","Costo": "0,0348","Unidades Restantes": 40},
      {"Codigo": 16,"Descripcion": "Conector Resina PLATA","Unidades": 40,"Precio": "1,3900","Costo": "0,0348","Unidades Restantes": 40},
      {"Codigo": 17,"Descripcion": "Conector Resina Trebol ORO","Unidades": 20,"Precio": "1,9300","Costo": "0,0965","Unidades Restantes": 20},
      {"Codigo": 18,"Descripcion": "Conector final","Unidades": 235,"Precio": "1,3000","Costo": "0,0055","Unidades Restantes": 235},
      {"Codigo": 114,"Descripcion": "Conector Doble Oro *15cm","Unidades": 20,"Precio": "2,0300","Costo": "0,1015","Unidades Restantes": 20},
      {"Codigo": 115,"Descripcion": "Conector Doble Plata *15cm","Unidades": 20,"Precio": "2,0300","Costo": "0,1015","Unidades Restantes": 20},
      {"Codigo": 116,"Descripcion": "Conector Triple Cadena Oro *20cm/30cm","Unidades": 2,"Precio": "1,0150","Costo": "0,5075","Unidades Restantes": 2},
      {"Codigo": 117,"Descripcion": "Conector Triple Cadena Plata *20cm/30cm","Unidades": 2,"Precio": "1,0150","Costo": "0,5075","Unidades Restantes": 2},
      {"Codigo": 118,"Descripcion": "Anilla Cuerda Oro *6mm","Unidades": 10,"Precio": "0,6389","Costo": "0,0639","Unidades Restantes": 10},
      {"Codigo": 119,"Descripcion": "Anilla Cuerda Plata *6mm","Unidades": 10,"Precio": "0,6389","Costo": "0,0639","Unidades Restantes": 10},
      {"Codigo": 120,"Descripcion": "Conector Doble Brillante Oro","Unidades": 10,"Precio": "0,7667","Costo": "0,0767","Unidades Restantes": 10},
      {"Codigo": 121,"Descripcion": "Conector Doble Brillante Plata","Unidades": 10,"Precio": "0,7667","Costo": "0,0767","Unidades Restantes": 10},
      {"Codigo": 124,"Descripcion": "Conectar Cuadruple Oro","Unidades": 2,"Precio": "0,5111","Costo": "0,2556","Unidades Restantes": 2},
      {"Codigo": 125,"Descripcion": "Conector Cuadruple Plata","Unidades": 2,"Precio": "0,5111","Costo": "0,2556","Unidades Restantes": 2},
      {"Codigo": 126,"Descripcion": "Conector Quintuple Plata","Unidades": 4,"Precio": "0,6389","Costo": "0,1597","Unidades Restantes": 4}
    ];

    // Extras disponibles
    const extras = {
      gift: { name: "Estuche para regalo", price: 5 },
      wrap: { name: "Envoltorio para regalo", price: 3 },
      urgent: { name: "Fabricaci√≥n urgente", price: 10 }
    };

    // Variables
    let cart = [];
    let selectedColor = "";
    let userDiscountCode = null;
    let userDisplayName = null;

    // Elementos del DOM
    const summary = document.getElementById("summary");
    const cartItems = document.getElementById("cartItems");
    const cartSummary = document.getElementById("cartSummary");
    const cartBtn = document.getElementById("openCart");
    const preview = document.getElementById("preview");
    const authButton = document.getElementById("authButton");
    const discountInput = document.getElementById("discount");

    // Generar c√≥digo de descuento √∫nico
    function generarCodigoDescuento() {
      const prefijos = ["BIENVENIDA", "LUZ", "AMOR", "ESTRELLA"];
      const prefijo = prefijos[Math.floor(Math.random() * prefijos.length)];
      const numero = Math.floor(Math.random() * 20 + 5);
      return prefijo + numero + Math.random().toString(36).substr(2, 4).toUpperCase();
    }

    // Mostrar modal de bienvenida
    function mostrarBienvenida(nombre) {
      const codeElem = document.getElementById("discountCode");
      codeElem.textContent = userDiscountCode;

      const titleElem = document.getElementById("welcomeTitle");
      titleElem.textContent = `üéâ ¬°Hola, ${nombre}!`;

      const messageElem = document.getElementById("welcomeMessage");
      messageElem.textContent = `Tu c√≥digo de descuento es:`;

      document.getElementById("welcomeModal").style.display = "block";
    }

    // Funciones del modal
    function closeModal() {
      document.getElementById("welcomeModal").style.display = "none";
    }

    function copyCode() {
      const code = document.getElementById("discountCode").textContent;
      navigator.clipboard.writeText(code).then(() => {
        alert("‚úÖ C√≥digo copiado al portapapeles!");
      });
    }

    function useCode() {
      const code = document.getElementById("discountCode").textContent;
      discountInput.value = code;
      alert(`‚úÖ C√≥digo "${code}" aplicado al campo.`);
      closeModal();
    }

    // Escuchar cambios de autenticaci√≥n
    auth.onAuthStateChanged(async (user) => {
      if (user) {
        const userRef = db.collection("usuarios").doc(user.uid);
        const doc = await userRef.get();

        if (!doc.exists) {
          userDiscountCode = generarCodigoDescuento();
          userDisplayName = user.displayName || user.email.split("@")[0];

          await userRef.set({
            email: user.email,
            nombre: userDisplayName,
            fechaRegistro: new Date(),
            codigoDescuento: userDiscountCode,
            usado: false,
            expira: new Date(Date.now() + 24 * 60 * 60 * 1000) // 24h despu√©s
          });

          mostrarBienvenida(userDisplayName);
        } else {
          const data = doc.data();
          userDiscountCode = data.codigoDescuento;
          userDisplayName = data.nombre;

          if (new Date() > new Date(data.expira)) {
            userDiscountCode = null;
          }
          if (data.usado) {
            userDiscountCode = null;
          }
        }
        authButton.textContent = "Cerrar sesi√≥n";
      } else {
        userDiscountCode = null;
        userDisplayName = null;
        authButton.textContent = "Iniciar sesi√≥n";
      }
      renderSummary();
    });

    // Manejar clic en bot√≥n de autenticaci√≥n
    authButton.addEventListener("click", () => {
      const user = auth.currentUser;
      if (user) {
        auth.signOut().then(() => {
          alert("Sesi√≥n cerrada correctamente.");
        });
      } else {
        const opcion = confirm("¬øQuieres iniciar sesi√≥n con Google?\nAceptar = Google, Cancelar = Correo y contrase√±a");
        if (opcion) {
          const provider = new firebase.GoogleAuthProvider();
          auth.signInWithPopup(provider).catch(error => {
            alert("Error al iniciar con Google: " + error.message);
          });
        } else {
          const email = prompt("üìß Introduce tu correo electr√≥nico:");
          if (!email) return;
          const password = prompt("üîë Introduce tu contrase√±a (m√≠nimo 6 caracteres):");
          if (!password || password.length < 6) {
            alert("La contrase√±a debe tener al menos 6 caracteres.");
            return;
          }

          auth.fetchSignInMethodsForEmail(email)
            .then(methods => {
              if (methods.length === 0) {
                return auth.createUserWithEmailAndPassword(email, password);
              } else {
                return auth.signInWithEmailAndPassword(email, password);
              }
            })
            .catch(error => {
              alert("Error: " + error.message);
            });
        }
      }
    });

    // Llenar selectores
    function llenarConectores() {
      const select = document.getElementById("add-conector-select");
      select.innerHTML = '<option value="">Seleccionar conector...</option>';
      materiales.forEach(item => {
        const option = document.createElement("option");
        option.value = item.Codigo;
        option.textContent = `${item.Descripcion} - ‚Ç¨${item.Precio}`;
        select.appendChild(option);
      });
    }

    // A√±adir conector
    document.getElementById("add-conector-btn").addEventListener("click", () => {
      const select = document.getElementById("add-conector-select");
      const codigo = select.value;
      if (!codigo) return;
      const material = materiales.find(m => m.Codigo == codigo);
      if (!material) return;

      const list = document.getElementById("conectores-list");
      const row = document.createElement("div");
      row.className = "item-row";
      row.dataset.codigo = codigo;
      row.innerHTML = `
        <span class="name">${material.Descripcion}</span>
        <input type="number" value="1" min="1" class="cantidad" style="width:50px;">
        <button class="remove">‚úñ</button>
      `;
      list.appendChild(row);
      select.value = "";
      renderSummary();
    });

    // A√±adir extra
    document.getElementById("add-extra-btn").addEventListener("click", () => {
      const select = document.getElementById("add-extra-select");
      const key = select.value;
      if (!key) return;
      const extra = extras[key];
      if (!extra) return;

      const list = document.getElementById("extras-list");
      const row = document.createElement("div");
      row.className = "item-row";
      row.dataset.key = key;
      row.innerHTML = `
        <span class="name">${extra.name}</span>
        <input type="number" value="1" min="1" class="cantidad" style="width:50px;">
        <button class="remove">‚úñ</button>
      `;
      list.appendChild(row);
      select.value = "";
      renderSummary();
    });

    // Eliminar elemento
    document.getElementById("conectores-list").addEventListener("click", (e) => {
      if (e.target.classList.contains("remove")) {
        e.target.closest(".item-row").remove();
        renderSummary();
      }
    });

    document.getElementById("extras-list").addEventListener("click", (e) => {
      if (e.target.classList.contains("remove")) {
        e.target.closest(".item-row").remove();
        renderSummary();
      }
    });

    // Obtener conectores seleccionados
    function getConectores() {
      const rows = document.querySelectorAll("#conectores-list .item-row");
      return Array.from(rows).map(row => {
        const codigo = row.dataset.codigo;
        const cantidad = parseInt(row.querySelector(".cantidad").value) || 1;
        return { codigo, cantidad };
      });
    }

    // Obtener extras seleccionados
    function getExtras() {
      const rows = document.querySelectorAll("#extras-list .item-row");
      return Array.from(rows).map(row => {
        const key = row.dataset.key;
        const cantidad = parseInt(row.querySelector(".cantidad").value) || 1;
        return { key, cantidad };
      });
    }

    // C√°lculo de precio
    function calculatePrice(config) {
      let price = 20;
      if (config.material === "oro") price += 30;
      if (config.material === "plata") price += 15;

      // Conectores
      getConectores().forEach(item => {
        const material = materiales.find(m => m.Codigo == item.codigo);
        if (material) {
          const precioNum = parseFloat(material.Precio.replace(",", "."));
          price += precioNum * item.cantidad;
        }
      });

      // Extras
      getExtras().forEach(item => {
        const extra = extras[item.key];
        if (extra) {
          price += extra.price * item.cantidad;
        }
      });

      price *= config.quantity;

      // Descuento
      if (config.discount && config.discount === "DESCUENTO10") {
        price *= 0.95;
      } else if (config.discount && config.discount === userDiscountCode) {
        const user = auth.currentUser;
        if (user) {
          db.collection("usuarios").doc(user.uid).get().then(doc => {
            const data = doc.data();
            if (data.usado) {
              alert("‚ùå Este c√≥digo ya fue usado.");
              return;
            }
            if (new Date() > new Date(data.expira)) {
              alert("‚ùå Este c√≥digo ha expirado.");
              return;
            }
            db.collection("usuarios").doc(user.uid).update({ usado: true });
            alert("‚úÖ ¬°C√≥digo de bienvenida aplicado! 5% de descuento.");
          });
        }
        price *= 0.95;
      }

      return Math.round(price * 100) / 100;
    }

    function getConfig() {
      return {
        product: document.getElementById("product").value,
        material: document.getElementById("material").value,
        color: selectedColor,
        colgante: document.getElementById("colgante").value,
        extras: getExtras(),
        conectores: getConectores(),
        discount: document.getElementById("discount").value,
        quantity: parseInt(document.getElementById("quantity").value) || 1
      };
    }

    function renderSummary() {
      const config = getConfig();
      const price = calculatePrice(config);
      summary.textContent = `Precio: ‚Ç¨${price}`;
      preview.innerHTML = `<strong>${config.product}</strong><br>Material: ${config.material}`;
    }

    function renderCart() {
      cartItems.innerHTML = "";
      let total = 0;

      cart.forEach((item, index) => {
        const div = document.createElement("div");
        div.className = "cesta-item";
        div.innerHTML = `
          <strong>${item.quantity}x ${item.product}</strong> (${item.material})<br>
          Colgante: ${item.colgante || "Ninguno"}<br>
          Conectores: ${item.conectores.length} tipo(s), Extras: ${item.extras.length} tipo(s)
          <hr>
        `;
        cartItems.appendChild(div);
        total += item.price;
      });

      cartSummary.textContent = `Total: ‚Ç¨${total}`;
      cartBtn.textContent = `üõí Cesta (${cart.length})`;
    }

    // A√±adir art√≠culo a la cesta
    document.getElementById("addProductToCart").addEventListener("click", () => {
      const config = getConfig();
      const price = calculatePrice(config);

      cart.push({
        ...config,
        price,
        id: Date.now()
      });

      renderCart();
      alert("‚úÖ Art√≠culo a√±adido a la cesta");

      // Limpiar formulario para nuevo art√≠culo
      document.getElementById("product").value = "collar";
      document.getElementById("material").value = "oro";
      document.getElementById("colgante").value = "";
      document.getElementById("quantity").value = 1;
      document.getElementById("discount").value = "";
      selectedColor = "";

      // Limpiar listas
      document.getElementById("conectores-list").innerHTML = '<div class="item-row" id="conector-template" style="display:none;"><span class="name"></span><input type="number" value="1" min="1" class="cantidad" style="width:50px;"><button class="remove">‚úñ</button></div>';
      document.getElementById("extras-list").innerHTML = '<div class="item-row" id="extra-template" style="display:none;"><span class="name"></span><input type="number" value="1" min="1" class="cantidad" style="width:50px;"><button class="remove">‚úñ</button></div>';

      // Resetear colores
      document.querySelectorAll(".color-ball").forEach(ball => ball.style.border = "1px solid #333");
      renderSummary();
    });

    // Pagar
    document.getElementById("pay").addEventListener("click", () => {
      if (cart.length === 0) {
        alert("Tu cesta est√° vac√≠a");
        return;
      }
      alert("‚úÖ Pago procesado. Gracias por tu compra.");
      cart = [];
      renderCart();
      document.getElementById("cartSidebar").classList.remove("open");
    });

    document.getElementById("payNow").addEventListener("click", () => {
      const config = getConfig();
      config.price = calculatePrice(config);
      alert(`‚úÖ Pago inmediato procesado - Total: ‚Ç¨${config.price}`);
    });

    // Eventos
    ["product", "material", "colgante", "discount", "quantity"].forEach(id => {
      const el = document.getElementById(id);
      el.addEventListener("input", renderSummary);
      el.addEventListener("change", renderSummary);
    });

    document.querySelectorAll(".color-ball").forEach(ball => {
      ball.addEventListener("click", () => {
        document.querySelectorAll(".color-ball").forEach(b => b.style.border = "1px solid #333");
        ball.style.border = "2px solid black";
        selectedColor = ball.dataset.color;
        renderSummary();
      });
    });

    document.getElementById("openCart").addEventListener("click", () => {
      document.getElementById("cartSidebar").classList.add("open");
    });

    document.getElementById("closeCart").addEventListener("click", () => {
      document.getElementById("cartSidebar").classList.remove("open");
    });

    // Inicializar
    window.onload = function() {
      llenarConectores();
      renderSummary();
    };
  </script>
</body>
</html>
